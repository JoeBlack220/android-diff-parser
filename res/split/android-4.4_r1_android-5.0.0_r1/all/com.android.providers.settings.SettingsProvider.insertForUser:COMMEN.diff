Find a functionally equivalent code:com.android.providers.settings.SettingsProvider.insertForUser:COMMENT
Method Modifier: private     
Comment:// policy around permission to write settings for other users.

@@ -29,34 +29,35 @@
     }
     // Check write permissions only after determining which table the insert will touch
     checkWritePermissions(args);
+    checkUserRestrictions(name, desiredUserHandle);
     // The global table is stored under the owner, always
     if (TABLE_GLOBAL.equals(args.table)) {
         desiredUserHandle = UserHandle.USER_OWNER;
@@ -38,49 +39,57 @@
     if (SettingsCache.isRedundantSetValue(cache, name, value)) {
         return Uri.withAppendedPath(url, name);
     }
-    final AtomicInteger mutationCount = sKnownMutationsInFlight.get(desiredUserHandle);
-    mutationCount.incrementAndGet();
+    final AtomicInteger mutationCount;
+    synchronized (this) {
+        mutationCount = sKnownMutationsInFlight.get(callingUser);
+    }
+    if (mutationCount != null) {
+        mutationCount.incrementAndGet();
+    }
     DatabaseHelper dbH = getOrEstablishDatabase(desiredUserHandle);
     SQLiteDatabase db = dbH.getWritableDatabase();
     final long rowId = db.insert(args.table, null, initialValues);
-    mutationCount.decrementAndGet();
+    if (mutationCount != null) {
+        mutationCount.decrementAndGet();
+    }
     if (rowId <= 0)
         return null;
     // before we notify

